var Timeline,Tweener,PathTweener;!function(){"use strict";Tweener=class{constructor(t,i,e){if(this.delay=t||0,this.dur=i||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1,"string"==typeof e){let t=e.toLowerCase();this.loop="loop"===t,this.loopAll="loopall"===t}}getVal(t,i,e){let s,n,a,r;0===t&&(this.reStartOfs=0),(r=t-this.reStartOfs)>this.dur+this.delay&&this.dur>0&&(this.loop||this.loopAll)&&(this.reStartOfs=this.loop?t-this.delay:t,r=0);let o=0;if(r>this.delay&&(o=r-this.delay),!Array.isArray(i))return i;if(!i.length)return 0;if(1===i.length)return i[0];if(0===o)return i[0];if(o>=this.dur)return i[i.length-1];const h=i.length-1;if(!Array.isArray(e)||i.length!==e.length)return s=this.dur/h,a=(o-(n=Math.floor(o/s))*s)/s,i[n]+a*(i[n+1]-i[n]);const l=[].concat(i),m=[].concat(e);0!==m[0]&&(l.unshift(l[0]),m.unshift(0)),100!==m[m.length-1]&&(l.push(l[l.length-1]),m.push(100));let c=o/this.dur,u=0;for(;u<m.length-1&&m[u+1]/100<c;)u++;return s=(m[u+1]-m[u])/100,a=(c-m[u]/100)/s,l[u]+a*(l[u+1]-l[u])}},PathTweener=class{constructor(t,i,e,s){if(!t instanceof SVGsegs)console.warn("Type Error: PathTweener argument 1 not an SVGsegs object");else if(this.track=t,this.delay=i||0,this.dur=e||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1,"string"==typeof s){let t=s.toLowerCase();this.loop="loop"===t,this.loopAll="loopall"===t}}getDist(t,i=[],e){0===t&&(this.reStartOfs=0);let s=t-this.reStartOfs;s>this.dur+this.delay&&this.dur>0&&(this.loop||this.loopAll)&&(this.reStartOfs=this.loop?t-this.delay:t,s=0);let n=0;if(s>this.delay&&(n=s-this.delay),"number"==typeof i)return 0<=i&&i<=100?i:(console.warn("Range Error: TrackTweener.getDist argument 2 (0 .. 100)"),0);if(!Array.isArray(i))return console.warn("Type Error: TrackTweener.getDist argument 2"),0;if(!i.length)return 0;if(1===i.length)return i[0];for(let t=0;t<i.length;t++)if(i[t]<0||i[t]>100)return console.warn("Range Error: TrackTweener.getDist argument 2 (0 .. 100)"),0;if(0===n)return i[0];if(n>=this.dur)return i[i.length-1];const a=i.length-1;if(!Array.isArray(e)||i.length!==e.length){let t=this.dur/a,e=Math.floor(n/t),s=(n-e*t)/t;return i[e]+s*(i[e+1]-i[e])}const r=[].concat(i),o=[].concat(e);0!==o[0]&&(r.unshift(r[0]),o.unshift(0)),100!==o[o.length-1]&&(r.push(r[r.length-1]),o.push(100));let h=n/this.dur,l=0;for(;l<o.length-1&&o[l+1]/100<h;)l++;let m=(o[l+1]-o[l])/100,c=(h-o[l]/100)/m;return r[l]+c*(r[l+1]-r[l])}getPos(t,i,e){const s=this.track.getTotalLength()*this.getDist(t,i,e)/100;return this.track.getPointAtLength(s)}};function t(t){const i=Date.now();let e,s,n=null,a=!1;t.prevAnimMode===t.modes.STOPPED&&(t.startTime=i-t.startOfs),e=i-t.startTime,t.animTasks.forEach(i=>{if(i.gc.cId!==n&&(a=!0,n=i.gc.cId),i.gc.ctx.save(),t.prevAnimMode===t.modes.STOPPED&&(i.currState.time=0),a&&!i.options.manualClear&&i.gc.clearCanvas(),"function"==typeof i.pathFn){if(t.frameRate){let n=i.currState.time+t.interval;for(;n+30<e;)i.pathFn.call(i,n,i.options),s=i.currState,i.currState=i.nextState,i.nextState=s,i.currState.time=n,n=i.currState.time+t.interval}i.pathFn.call(i,e,i.options)}"function"==typeof i.drawFn&&i.drawFn.call(i,i.options),a=!1,i.gc.ctx.restore(),s=i.currState,i.currState=i.nextState,i.nextState=s,i.currState.time=e}),t.currTime=e}Timeline=class{constructor(){this.animTasks=[],this.timer=null,this.modes={PAUSED:1,STOPPED:2,PLAYING:3,STEPPING:4},this.animMode=this.modes.STOPPED,this.prevAnimMode=this.modes.STOPPED,this.startTime=0,this.startOfs=0,this.currTime=0,this.stepTime=50,this.frameRate=void 0,this.interval=0}stopAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.STOPPED,this.currTime=0,this.startOfs=0}pauseAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.PAUSED}stepAnimation(){this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.STEPPING,setTimeout(()=>{t(this),this.prevAnimMode=this.modes.PAUSED,this.animMode=this.modes.PAUSED},this.stepTime))}redrawAnimation(){this.animMode!==this.modes.PLAYING&&(this.startTime=Date.now()-this.currTime,t(this))}playAnimation(i,e){const s=()=>{t(this),this.prevAnimMode=this.modes.PLAYING,e&&this.currTime>=e?this.stopAnimation():(this.frameRate&&(this.interval=1e3/this.frameRate),this.timer=window.requestAnimationFrame(s))};this.startOfs=i||0,this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.PLAYING,this.timer=window.requestAnimationFrame(s))}},Cango.prototype.animation=function(t,i,e){const s=new class{constructor(t,i,e,s,n){this.id=t,this.gc=i,this.drawFn=e,this.pathFn=s,this.options=n||{},this.currState={time:0},this.nextState={time:0},this.gc.ctx.save(),"function"==typeof this.pathFn&&this.pathFn.call(this,0,this.options),"function"==typeof this.drawFn?this.drawFn.call(this,this.options):console.log("invalid animation draw function"),this.gc.ctx.restore();for(let t in this.nextState)this.nextState.hasOwnProperty(t)&&(this.currState[t]=this.nextState[t])}}(this.cId+"_"+this.getUnique(),this,t,i,e);return this.stopAnimation(),this.bkgCanvas.timeline.animTasks.push(s),s.id},Cango.prototype.pauseAnimation=function(){this.bkgCanvas.timeline.pauseAnimation()},Cango.prototype.playAnimation=function(t,i){this.bkgCanvas.timeline.playAnimation(t,i)},Cango.prototype.stopAnimation=function(){this.bkgCanvas.timeline.stopAnimation()},Cango.prototype.stepAnimation=function(){this.bkgCanvas.timeline.stepAnimation()},Cango.prototype.redrawAnimation=function(){this.bkgCanvas.timeline.redrawAnimation()},Cango.prototype.deleteAnimation=function(t){this.pauseAnimation(),this.bkgCanvas.timeline.animTasks.forEach((i,e)=>{i.id!==t||this.bkgCanvas.timeline.animTasks.splice(e,1)})},Cango.prototype.deleteAllAnimations=function(){this.stopAnimation(),this.bkgCanvas.timeline.animTasks=[]},Cango.prototype.setAnimationProperty=function(t,i){if("string"==typeof t&&null!=i)switch(t.toLowerCase()){case"steptime":i>=15&&i<=500&&(this.bkgCanvas.timeline.stepTime=i);break;case"minframerate":case"framerate":if(i&&"auto"===i)this.bkgCanvas.timeline.frameRate=void 0;else if(isNaN(i)||i>30||i<.5)return void console.warn("Range Error: setPropertyDefault frameRate (0.5 .. 30)");this.bkgCanvas.timeline.frameRate=i}}}();