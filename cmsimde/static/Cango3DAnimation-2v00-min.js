var Timeline,Tweener;Cango3D=function(t){"use strict";Tweener=class{constructor(t,i,s){this.delay=t||0,this.dur=i||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1;let e="noloop";"string"==typeof s&&(e=s.toLowerCase()),"loop"===e?this.loop=!0:"loopall"===e&&(this.loopAll=!0)}getVal(t,i,s){let e,n,o,a;0===t&&(this.reStartOfs=0),(a=t-this.reStartOfs)>this.dur+this.delay&&this.dur>0&&(this.loop||this.loopAll)&&(this.reStartOfs=this.loop?t-this.delay:t,a=0);let r=0;if(a>this.delay&&(r=a-this.delay),!Array.isArray(i))return i;if(!i.length)return 0;if(1===i.length)return i[0];if(0===r)return i[0];if(r>=this.dur)return i[i.length-1];const h=i.length-1;if(!Array.isArray(s)||i.length!==s.length)return e=this.dur/h,o=(r-(n=Math.floor(r/e))*e)/e,i[n]+o*(i[n+1]-i[n]);const m=[].concat(i),c=[].concat(s);0!==c[0]&&(m.unshift(m[0]),c.unshift(0)),100!==c[c.length-1]&&(m.push(m[m.length-1]),c.push(100));let l=r/this.dur,d=0;for(;d<c.length-1&&c[d+1]/100<l;)d++;return e=(c[d+1]-c[d])/100,o=(l-c[d]/100)/e,m[d]+o*(m[d+1]-m[d])}};function i(t){const i=Date.now();let s,e,n=null,o=!1;t.prevAnimMode===t.modes.STOPPED&&(t.startTime=i-t.startOfs),s=i-t.startTime,t.animTasks.forEach(i=>{i.gc.cId!==n&&(o=!0,n=i.gc.cId),i.gc.ctx.save(),t.prevAnimMode===t.modes.STOPPED&&(i.currState.time=0),o&&!i.options.manualClear&&i.gc.clearCanvas(),"function"==typeof i.pathFn&&i.pathFn.call(i,s,i.options),"function"==typeof i.drawFn&&i.drawFn.call(i,i.options),o=!1,i.gc.ctx.restore(),e=i.currState,i.currState=i.nextState,i.nextState=e,i.currState.time=s}),t.currTime=s}return Timeline=class{constructor(){this.animTasks=[],this.timer=null,this.modes={PAUSED:1,STOPPED:2,PLAYING:3,STEPPING:4},this.animMode=this.modes.STOPPED,this.prevAnimMode=this.modes.STOPPED,this.startTime=0,this.startOfs=0,this.currTime=0,this.stepTime=50,this.frameRate=void 0,this.interval=0}stopAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.STOPPED,this.currTime=0,this.startOfs=0}pauseAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.PAUSED}stepAnimation(){this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.STEPPING,setTimeout(()=>{i(this),this.prevAnimMode=this.modes.PAUSED,this.animMode=this.modes.PAUSED},this.stepTime))}redrawAnimation(){this.animMode!==this.modes.PLAYING&&(this.startTime=Date.now()-this.currTime,i(this))}playAnimation(t,s){let e=0;const n=()=>{i(this),this.prevAnimMode=this.modes.PLAYING,s&&this.currTime>=s?this.stopAnimation():this.frameRate?(this.interval=1e3/this.frameRate,this.currTime+=this.interval,e=Date.now()-this.startTime-this.currTime,this.timer=setTimeout(n,this.interval-e)):this.timer=window.requestAnimationFrame(n)};this.startOfs=t||0,this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.PLAYING,this.timer=window.requestAnimationFrame(n))}},t.prototype.getUnique=function(){return this.cnvs.unique+=1,this.cnvs.unique},t.prototype.animation=function(t,i,s){const e=new class{constructor(t,i,s,e,n){this.id=t,this.gc=i,this.drawFn=s,this.pathFn=e,this.options=n||{},this.currState={time:0},this.nextState={time:0},this.gc.ctx.save(),"function"==typeof e&&e.call(this,0,this.options),"function"==typeof this.drawFn?this.drawFn.call(this,this.options):console.log("invalid animation draw function");for(let t in this.nextState)this.nextState.hasOwnProperty(t)&&(this.currState[t]=this.nextState[t])}}(this.cId+"_"+this.getUnique(),this,t,i,s);return this.stopAnimation(),this.cnvs.timeline.animTasks.push(e),e.id},t.prototype.pauseAnimation=function(){this.cnvs.timeline.pauseAnimation()},t.prototype.playAnimation=function(t,i){this.cnvs.timeline.playAnimation(t,i)},t.prototype.stopAnimation=function(){this.cnvs.timeline.stopAnimation()},t.prototype.stepAnimation=function(){this.cnvs.timeline.stepAnimation()},t.prototype.redrawAnimation=function(){this.cnvs.timeline.redrawAnimation()},t.prototype.deleteAnimation=function(t){this.pauseAnimation(),this.cnvs.timeline.animTasks.forEach((i,s)=>{i.id!==t||this.cnvs.timeline.animTasks.splice(s,1)})},t.prototype.deleteAllAnimations=function(){this.stopAnimation(),this.cnvs.timeline.animTasks=[]},t}(Cango3D);